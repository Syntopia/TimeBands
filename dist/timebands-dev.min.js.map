{"version":3,"sources":["TextBoxStyle.js","Viewport.js","Band.js","TimeBand.js","timebands.js","timebandsparser.js"],"names":["TextBoxStyle","this","rx","ry","strokeWidth","textStroke","textStrokeWidth","opacity","bgfill","textFill","fontSize","section","Viewport","svg","zoom","centerX","scalableElements","self","addEventListener","e","mouseWheel","mouseDown","mouseUp","mouseMove","prototype","dragging","rect","getBoundingClientRect","mX","clientX","left","clientY","top","centerXDown","mouseDownX","redraw","mouseDownY","dirty","ScaleInfo","textWidth","rectWidth","textHeight","rectHeight","uniformScale","getRatio","getHeightRatio","rescale","getElementById","transform","replace","setAttribute","width","undefined","scaleMap","Map","i","length","rectNode","childNodes","textNode","getBBox","height","console","log","set","scaleInfo","get","ratio","factor","deltaY","preventDefault","dx","from","dx2","Band","timeBand","name","defaultBandHeight","yOffset","infos","addBand","s","bottom","g","add","constructor","init","canvasID","addListeners","fromDay","toDay","text","style","hint","target","y","h","headerHeight","groupElement","timebands","addBox","cellWidth","push","boxClicked","boxMouseover","boxMouseout","stroke","originalStroke","TimeBand","startYear","startMonth","numberOfDays","view","ne","document","createElementNS","l1","createLinearGradient","appendChild","createStop","l2","l3","ne2","ne3","nextYOffset","bands","monthNames","monthColors2","monthColors","band","addHeader","tb","months","weeks","weeksNumbers","lastMonth","lastWeek","days","x","d","Date","getMonth","week","getWeekNumber","getDate","weeksBand","monthsBand","x2","addOverlay","REVISION","dateDiffInDays","a","b","utc1","UTC","getFullYear","utc2","Math","floor","setHours","setDate","getDay","ceil","id","x1","y1","y2","offset","w","ontop","fill","originalStrokeWidth","t","fontfamily","textContent","ti","hasChildNodes","children","insertBefore","defs","startDate","spacing","ss","parser","TimeBandsParser","parse","innerHTML","bandSections","bs","startsWith","substr","j","entries","interval","getIntervalRelativeToDate","today","BandEntry","ii","create","svgID","defsID","to","date","f","BandSection","toString","addEntry","TimeParser","implicitYear","parseInterval","l","split","parseTime","trim","parseInt","timeParser","addBandSection","parseEntry","txt","lines","match","bandSection"],"mappings":"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","file":"timebands-dev.min.js","sourcesContent":["var TextBoxStyle = function() {\r\n    this.rx = 0;\r\n    this.ry = 0;\r\n    this.strokeWidth = 0.2;\r\n    this.textStroke = \"#000\";\r\n    this.textStrokeWidth = 0;\r\n    this.opacity = 1;\r\n    this.bgfill = \"white\";\r\n    this.textFill = \"#000\";\r\n    this.fontSize = 18;\r\n    this.section = false;\r\n};\r\n","var Viewport = function(svg) {\n\tthis.zoom = 1.0;\n\tthis.centerX = 0.0;\n\tthis.svg = svg;\n\tthis.scalableElements = [];\n\tvar self = this;\n\tthis.svg.addEventListener('wheel', function(e) {\n\t\tself.mouseWheel(e);\n\t}, false);\n\tthis.svg.addEventListener('mousedown', function(e) {\n\t\tself.mouseDown(e);\n\t}, false);\n\tthis.svg.addEventListener('mouseup', function(e) {\n\t\tself.mouseUp(e);\n\t}, false);\n\tthis.svg.addEventListener('mousemove', function(e) {\n\t\tself.mouseMove(e);\n\t}, false);\n}\n\nViewport.prototype.mouseUp = function(e) {\n\tthis.dragging = false;\n}\n\nViewport.prototype.mouseMove = function(e) {\n\tif (this.dragging) {\n\t\tvar rect = svg.getBoundingClientRect();\n\t\tvar mX = e.clientX - rect.left;\n\t\tvar mY = e.clientY - rect.top;\n\t\tthis.centerX = this.centerXDown + 2.0 * (mX - this.mouseDownX) / this.zoom;\n\t\tthis.redraw(false, e);\n\t}\n}\n\nViewport.prototype.mouseDown = function(e) {\n\tvar rect = svg.getBoundingClientRect();\n\tthis.mouseDownX = e.clientX - rect.left;\n\tthis.mouseDownY = e.clientY - rect.top;\n\tthis.centerXDown = this.centerX;\n\tthis.dragging = true;\n\tthis.dirty = true;\n}\n\nvar ScaleInfo = function(textWidth, rectWidth, textHeight, rectHeight, uniformScale) {\n\tthis.textWidth = textWidth;\n\tthis.rectWidth = rectWidth;\n\tthis.textHeight = textHeight;\n\tthis.rectHeight = rectHeight;\n\tthis.uniformScale = uniformScale;\n\tthis.getRatio = function() {\n\t\treturn rectWidth / textWidth;\n\t}\n\tthis.getHeightRatio = function() {\n\t\treturn rectHeight / textHeight;\n\t}\n}\n\nViewport.prototype.redraw = function(rescale, e) {\n\tvar top = svg.getElementById('svgtop');\n\tvar transform = \"matrix(sx 0 0 1 tx 0)\".replace(\"sx\", this.zoom).replace(\"tx\", this.centerX * this.zoom);\n\ttop.setAttribute(\"transform\", transform);\n\n\tvar rect = svg.getBoundingClientRect();\n\tvar mX = e.clientX - rect.left;\n\tvar w = svg.getBoundingClientRect().width;\n\tvar dx = mX * this.zoom;\n\tvar from = -this.centerX;\n\t//console.log(\"From: \" + from + \" to: \" + (from + w / this.zoom) + \" me:\" + (from + (mX / this.zoom)));\n\n\tif (!rescale) return;\n\n\tif (this.scaleMap === undefined) {\n\t\tthis.scaleMap = new Map();\n\t\tfor (var i = 0; i < this.scalableElements.length; i++) {\n\t\t\tvar rectNode = this.scalableElements[i].childNodes[0];\n\t\t\tvar textNode = this.scalableElements[i].childNodes[1];\n\t\t\tvar width = textNode.getBBox().width + 5;\n\t\t\tvar rectWidth = rectNode.getBBox().width;\n\t\t\tvar height = textNode.getBBox().height-10 ;\n\t\t\tvar rectHeight = rectNode.getBBox().height;\n\t\t\tif (this.scalableElements[i].uniformScale) {\n\t\t\t\tconsole.log(width);\n\t\t\t\twidth = this.scalableElements[i].uniformScale;\n\t\t\t}\n\t\t\tthis.scaleMap.set(this.scalableElements[i], new ScaleInfo(width, rectWidth,height,rectHeight, this.scalableElements[i].uniformScale));\n\t\t}\n\t}\n\n\tfor (var i = 0; i < this.scalableElements.length; i++) {\n\t\tvar rectNode = this.scalableElements[i].childNodes[0];\n\t\tvar textNode = this.scalableElements[i].childNodes[1];\n\t\ttextNode.setAttribute(\"transform\", \"scale(\" + (1 / this.zoom) + \",1)\");\n\t\tvar scaleInfo = this.scaleMap.get(this.scalableElements[i]);\n\t\tvar ratio = scaleInfo.getRatio() * this.zoom;\n\t\t\n\t\tvar opacity = 1;\n\t\tif (scaleInfo.rectWidth * this.zoom < 5) {\n\t\t\trectNode.setAttribute(\"visibility\", \"hidden\");\n\t\t} else {\n\t\t\trectNode.setAttribute(\"visibility\", \"visible\");\n\t\t}\n\t\tif (ratio < 0.1) {\n\t\t\ttextNode.setAttribute(\"visibility\", \"hidden\");\n\t\t} else {\n\t\t\ttextNode.setAttribute(\"visibility\", \"visible\");\n\t\t\tif (ratio < 1) {\n\t\t\t\tif (scaleInfo.uniformScale) {\n\t\t\t\t\ttextNode.setAttribute(\"visibility\", \"hidden\");\n\t\t\t\trectNode.setAttribute(\"visibility\", \"hidden\");\n\t\t\t} else {\n\t\t\t\t\ttextNode.setAttribute(\"transform\", \"scale(\" + (ratio / this.zoom)+ \",\" + ratio +  \")\");\n\t\t\t\t\ttextNode.setAttribute(\"x\", 0);\n\t\t\t\t\ttextNode.setAttribute(\"y\", ((1.0/ratio)*2.0*scaleInfo.rectHeight/ 2 - scaleInfo.textHeight / 2));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttextNode.setAttribute(\"x\", (scaleInfo.rectWidth * this.zoom / 2 - scaleInfo.textWidth / 2));\n\t\t\t\ttextNode.setAttribute(\"y\", (2.0*scaleInfo.rectHeight/ 2 - scaleInfo.textHeight / 2));\n\t\t\t}\n\t\t}\n\n\t\ttextNode.setAttribute(\"opacity\", opacity);\n\t}\n};\n\nViewport.prototype.mouseWheel = function(e) {\n\tvar factor = 1.;\n\tif (e.deltaY > 0) {\n\t\tfactor = 1.2;\n\t} else {\n\t\tfactor = 1 / 1.2;\n\t}\n\te.preventDefault();\n\n\tvar rect = svg.getBoundingClientRect();\n\tvar mX = e.clientX - rect.left;\n\tvar w = svg.getBoundingClientRect().width;\n\tvar dx = mX / this.zoom;\n\tvar from = -this.centerX;\n\n\tthis.zoom *= factor;\n\n\tvar dx2 = mX / this.zoom;\n\tthis.centerX += (dx2 - dx);\n\tfrom = -this.centerX;\n\n\tthis.redraw(true, e);\n\treturn false;\n}\n","var Band = function(timeBand, height, name) {\n\tif (height !== undefined) {\n\t\tthis.height = height;\n\t} else {\n\t\tthis.height = timeBand.defaultBandHeight;\n\t}\n\tthis.yOffset = 0;\n\tthis.infos = {};\n\tthis.timeBand = timeBand;\n\ttimeBand.addBand(this);\n\tif (name !== undefined) {\n\t\tvar s = new TextBoxStyle();\n\t\ts.opacity = 1.0;\n\t\ts.strokeWidth = 0.5;\n\t\ts.bgfill = \"#fff\";\n\t\ts.fontSize = 20;\n\t\ts.textStroke = \"#fff\";\n\t\ts.textStrokeWidth = 0;\n\t\ts.textFill = \"#000\";\n\t\ts.rx = 5;\n\t\ts.ry = 5;\n\t\tvar bottom = this.timeBand.svg.getElementById('svgbottom');\n\t\tvar g = this.add(0, 8, name, s, undefined, bottom);\n\t\tvar rectNode = g.childNodes[0];\n\t\tvar textNode = g.childNodes[1];\n\t\tvar width = textNode.getBBox().width + 5;\n\t\trectNode.setAttribute(\"width\", width + 5);\n\t}\n};\n\nBand.prototype = {\n\tconstructor: Band,\n\n\tinit: function(canvasID) {\n\t\tthis.addListeners(canvasID);\n\t},\n\n\tadd: function(fromDay, toDay, text, style, hint, target) {\n\t\tif (target === undefined) {\n\t\t\ttarget = this.timeBand.top;\n\t\t}\n\t\tvar y = this.yOffset;\n\t\tvar h = this.height;\n\t\tif (style.section) {\n\t\t\ty -= this.yOffset-this.timeBand.headerHeight;\n\t\t\th += this.yOffset-this.timeBand.headerHeight;\n\t\t}\n\t\tvar groupElement = timebands.addBox(target,\n\t\t\tthis.timeBand.cellWidth * fromDay, y,\n\t\t\tthis.timeBand.cellWidth * (toDay - fromDay), h,\n\t\t\ttext, style, hint);\n\t\t\t\n\t\tthis.infos[groupElement] = \" Text: \" + text;\n\t\t\t\n\t\tif (target === this.timeBand.top) {\n\t\t\tif (this.uniformScale) {\n\t\t\t\tgroupElement.uniformScale = this.uniformScale;\n\t\t\t}\n\t\t\tthis.timeBand.scalableElements.push(groupElement);\n\t\t}\n\t\tvar self = this;\n\t\tgroupElement.addEventListener('click', function(e) {\n\t\t\tself.boxClicked(groupElement);\n\t\t});\n\t\t\t\t\n\t\tif (!style.section) {\n\t\t\tgroupElement.addEventListener('mouseover', function(e) {\n\t\t\t\tself.boxMouseover(groupElement);\n\t\t\t});\n\t\t\tgroupElement.addEventListener('mouseout', function(e) {\n\t\t\t\tself.boxMouseout(groupElement);\n\t\t\t});\n\t\t}\n\t\treturn groupElement;\n\t},\n\n\tboxClicked: function(e) {\n\t\tconsole.log(\"Clicked: \", this.infos[e]);\n\t},\n\n\tboxMouseover: function(e) {\n\t\tvar rectNode = e.childNodes[0];\n\t\tvar textNode = e.childNodes[1];\n\t\trectNode.style.stroke = \"red\";\n\t\trectNode.style.strokeWidth = \"2\";\n\n\t},\n\n\tboxMouseout: function(e) {\n\t\tvar rectNode = e.childNodes[0];\n\t\tvar textNode = e.childNodes[1];\n\t\trectNode.style.stroke = rectNode.style.originalStroke;\n\t\trectNode.style.stroke = \"black\";\n\t\trectNode.style.strokeWidth = \"0.2\";\n\t}\n\n}\n","var TimeBand = function(svg, startYear, startMonth, numberOfDays) {\n\n\tthis.view = new Viewport(svg);\n\tvar ne = document.createElementNS(\"http://www.w3.org/2000/svg\", 'defs'); \n\tvar l1=timebands.createLinearGradient(\"grad1\", \"0%\", \"30%\", \"0%\", \"100%\");\n\tl1.appendChild(timebands.createStop(\"0%\",  \"stop-color:rgb(240,224,195);stop-opacity:1\")); \n\tl1.appendChild(timebands.createStop(\"100%\",\"stop-color:rgb(240,224,195);stop-opacity:1\"));\n\tvar l2=timebands.createLinearGradient(\"grad3\", \"0%\", \"30%\", \"0%\", \"100%\");\n\tl2.appendChild(timebands.createStop(\"0%\",\"stop-color:rgb(255,255,255);stop-opacity:1\"));\n\tl2.appendChild(timebands.createStop(\"100%\",\"stop-color:rgb(225,225,225);stop-opacity:1\"));\n\tvar l3=timebands.createLinearGradient(\"grad2\", \"0%\", \"30%\", \"0%\", \"100%\");\n\tl3.appendChild(timebands.createStop(\"0%\",\"stop-color:rgb(192,208,163);stop-opacity:1\"));\n\tl3.appendChild(timebands.createStop(\"100%\",\"stop-color:rgb(192,208,163);stop-opacity:1\"));\n\tne.appendChild(l1);\n\tne.appendChild(l2);\n\tne.appendChild(l3);\n\tsvg.appendChild(ne);\n\t\n\tvar ne2 = document.createElementNS(\"http://www.w3.org/2000/svg\", 'g'); \n\tne2.setAttribute(\"id\", \"svgtop\");\n\tvar ne3 = document.createElementNS(\"http://www.w3.org/2000/svg\", 'g'); \n\tne3.setAttribute(\"id\", \"svgbottom\");\n\tsvg.appendChild(ne2);\n\tsvg.appendChild(ne3);\n\t\n\n\tthis.startYear = startYear;\n\tthis.scalableElements = [];\n\tthis.numberOfDays = numberOfDays;\n\tthis.startMonth = startMonth;\n\tthis.defaultBandHeight = 20;\n\tthis.svg = svg;\n\tthis.cellWidth = 20;\n\tthis.top = svg.getElementById('svgtop');\n\tthis.nextYOffset = 0;\n\tthis.bands = [];\n};\n\nTimeBand.monthNames = [\"Jan\", \"Feb\", \"Mar\",\n\t\t\t\t \"Apr\", \"May\", \"Jun\", \"Jul\",\n\t\t\t\t\"Aug\", \"Sep\", \"Oct\",\n\t\t\t\t\"Nov\", \"Dec\"];\nTimeBand.monthColors2 = [\"#FC9\", \"#FEC\", \"#FC9\",\n\t\t\t\t\"#CDA\", \"#EED\", \"#CDA\",\n\t\t\t\t\"#FC9\", \"#FEC\", \"#FC9\",\n\t\t\t\t\"#CDA\", \"#EED\", \"#CDA\"];\nTimeBand.monthColors = [\"#EEE\", \"#FFF\", \"#EEE\",\n\t\t\t\t\"#FFF\", \"#EEE\", \"#FFF\",\n\t\t\t\t\"#EEE\", \"#FFF\", \"#EEE\",\n\t\t\t\t\"#FFF\", \"#EEE\", \"#FFF\"];\n\nTimeBand.prototype = {\n\tconstructor: TimeBand,\n\n\taddBand: function(band) {\n\t\tthis.bands.push(band);\n\t\tband.yOffset = this.nextYOffset;\n\t\tthis.nextYOffset += band.height;\n\t\tconsole.log(\"Added band \" + band + \". Current offset: \" + this.nextYOffset);\n\t},\n\t\n\taddHeader: function() {\n\t\tvar style = new TextBoxStyle();\n\t\tvar tb = this;\n\t\tvar months = [];\n\t\tvar weeks = [];\n\t\tvar weeksNumbers = [];\n\t\tvar lastMonth = -1;\n\t\tvar lastWeek = -1;\n\t\tvar days = new Band(tb,13);\n\t\tdays.uniformScale = 16;\n\t\t\n\t\tstyle.fontSize=10;\n\t\tfor (var x = 0; x < this.numberOfDays; x++) {\n\t\t\tvar d = new Date(tb.startYear,tb.startMonth,x+1) ;\n\t\t\tif (d.getMonth()!=lastMonth) {\n\t\t\t\tmonths.push(x);\n\t\t\t\tlastMonth = d.getMonth();\n\t\t\t}\n\t\t\tvar week = d.getWeekNumber();\n\t\t\tif (week!=lastWeek) {\n\t\t\t\tweeks.push(x);\n\t\t\t\tweeksNumbers.push(week);\n\t\t\t\tlastWeek = week;\n\t\t\t}\n\t\t\tdays.add(x,x+1, d.getDate(), style, d+\"\");\n\t\t}\n\t\tmonths.push(this.numberOfDays);\n\n\t\tstyle.fontSize=18;\n\n\t\tvar weeksBand = new Band(tb);\n\t\tweeksBand.uniformScale = 25;\n\t\tfor (var i = 0; i < weeks.length-1; i++) {\n\t\t\tstyle.bgfill = (i % 2 == 1) ? \"none\" : \"#eee\";\n\t\t\tstyle.textFill = (i % 2 == 0) ? \"#fff\" : \"#fff\";\n\t\t\tconsole.log(\"Week \" + i + \" from \" + weeks[i] + \" to: \" + weeks[i+1]);\n\t\t\tweeksBand.add(weeks[i], weeks[i+1], weeksNumbers[i], style);\n\t\t}\n\t\t\n\t\tvar monthsBand = new Band(tb);\n\t\tmonthsBand.uniformScale = 37;\n\t\tfor (var i = 0; i < months.length-1; i++) {\n\t\t\tvar x = months[i];\n\t\t\tvar x2 = months[i+1];\n\t\t\tvar d = new Date(tb.startYear,tb.startMonth,x+1) ;\n\t\t\tstyle.bgfill = TimeBand.monthColors[d.getMonth()];\n\t\t\tmonthsBand.add(x, x2, TimeBand.monthNames[d.getMonth()], style);\n\t\t}\n\t\tthis.headerHeight = this.nextYOffset;\n\t},\n\t\n\taddOverlay: function() {\n\t\tvar style = new TextBoxStyle();\n\t\tvar tb = this;\n\t\tvar weeks = [];\n\t\tvar lastWeek = -1;\n\t\tstyle.fontSize=10;\n\t\tfor (var x = 0; x < this.numberOfDays; x++) {\n\t\t\tvar d = new Date(tb.startYear,tb.startMonth,x+1) ;\n\t\t\tvar week = d.getWeekNumber();\n\t\t\tif (week!=lastWeek) {\n\t\t\t\tweeks.push(x);\n\t\t\t\tlastWeek = week;\n\t\t\t}\n\t\t}\n\t\t\n\t\tstyle.fontSize=18;\n\t\tstyle.strokeWidth = 0.8;\n\t\tstyle.textStroke = \"#000\";\n\t\tstyle.textStrokeWidth = 0;\n\t\tstyle.opacity = 0.03; \n\t\t\t\n\t\tfor (var i = 0; i < weeks.length-1; i++) {\n\t\t\tstyle.bgfill = (i % 2 == 1) ? \"#555\" : \"#555\";\n\t\t\tstyle.textFill = (i % 2 == 0) ? \"#fff\" : \"#fff\";\n\t\t\tvar currentDay = timebands.addBox(this.top,\n\t\t\t\tthis.cellWidth * (weeks[i]+5), this.headerHeight,\n\t\t\t\tthis.cellWidth * (2), this.nextYOffset-this.headerHeight,\n\t\t\t\t\"\", style, \"\", true);\n\t\t}\n\t\t\n\t\n\t\n\t}\n\t\n};\n","/**\n * @author Mikael Hvidtfeldt Christensen / twitter: @SyntopiaDK, web: hvidtfeldts.net\n */\n\nvar timebands = {\n    REVISION: '0.0.1'\n};\n\n\n\n/**\n * Taken from: http://stackoverflow.com/questions/3224834/get-difference-between-2-dates-in-javascript\n * (post by Shyam Habarakada)\n */\ntimebands.dateDiffInDays = function(a, b) {\n    // Discard the time and time-zone information.\n    var utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());\n    var utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());\n\n    return Math.floor((utc2 - utc1) / (1000 * 60 * 60 * 24)); // ms per day\n}\n\n/**\n * This functions was taken from RobG answer here:\n * http://stackoverflow.com/questions/6117814/get-week-of-year-in-javascript-like-in-php\n */\nDate.prototype.getWeekNumber = function() {\n    var d = new Date(+this);\n    d.setHours(0, 0, 0);\n    d.setDate(d.getDate() + 4 - (d.getDay() || 7));\n    return Math.ceil((((d - new Date(d.getFullYear(), 0, 1)) / 8.64e7) + 1) / 7);\n};\n\n\ntimebands.createLinearGradient = function(id,x1,y1,x2,y2) {\n\tvar ne = document.createElementNS(\"http://www.w3.org/2000/svg\", 'linearGradient'); \n\tne.setAttribute(\"id\",id);\n\tne.setAttribute(\"x1\",x1);\n\tne.setAttribute(\"y1\",y1);\n\tne.setAttribute(\"x2\",x2);\n\tne.setAttribute(\"y2\",y2);\n\treturn ne;\n}\n\ntimebands.createStop = function(offset,style) {\n\tvar ne = document.createElementNS(\"http://www.w3.org/2000/svg\", 'stop'); \n\tne.setAttribute(\"offset\",offset);\n\tne.setAttribute(\"style\",style);\n\treturn ne;\n}\n\n\ntimebands.addBox = function(svg, x, y, w, h, text, style, hint, ontop) {\n    var g = document.createElementNS(\"http://www.w3.org/2000/svg\", 'g');\n    g.setAttribute(\"transform\", \"translate(\" + x + \",\" + y + \")\");\n\n    var e = document.createElementNS(\"http://www.w3.org/2000/svg\", 'rect');\n    e.style.fill = style.bgfill;\n    e.style.stroke = \"black\";\n    e.style.originalStroke = e.style.stroke;\n    e.setAttribute(\"x\", 0);\n    e.setAttribute(\"y\", 0);\n    e.setAttribute(\"width\", w);\n    e.setAttribute(\"height\", h);\n    e.setAttribute(\"rx\", style.rx);\n    e.setAttribute(\"ry\", style.ry);\n    e.style.strokeWidth = style.strokeWidth;\n    e.style.originalStrokeWidth = e.style.strokeWidth;\n    e.style.opacity = style.opacity;\n\n    var t = document.createElementNS(\"http://www.w3.org/2000/svg\", 'text');\n    t.setAttribute(\"x\", 5);\n    t.setAttribute(\"transform\", \"scale(1,1)\");\n    t.style.fontfamily = \"Helvetica\";\n    t.setAttribute(\"y\", h - 3);\n    t.setAttribute(\"font-size\", style.fontSize);\n    g.setAttribute(\"alignment-baseline\", \"baseline\");\n    t.textContent = text;\n    g.appendChild(e);\n    g.appendChild(t);\n\n    if (hint !== undefined) {\n        var ti = document.createElementNS(\"http://www.w3.org/2000/svg\", 'title');\n        ti.textContent = hint;\n        g.appendChild(ti);\n    }\n\n    if (svg.hasChildNodes() && svg.children !== undefined && ontop === undefined) {\n        svg.insertBefore(g, svg.children[0]);\n    } else {\n        svg.appendChild(g);\n    }\n    return g;\n};\n\n\ntimebands.init = function(svg, defs, startYear, startMonth, numberOfDays) {\n\tvar startDate = new Date(startYear,startMonth-1,1);\n\tsvg.setAttribute(\"style\", \"font-family: Helvetica, Arial;-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;\");\n\t\n\tvar tb = new TimeBand(svg,startYear,startMonth-1, numberOfDays);\n\ttb.addHeader();\n\tvar spacing = 7;\n\tvar height = 30;\n\n\tvar ss = new TextBoxStyle();\n\tss.fontSize = 20;\n\tss.rx = 3;\n\tss.ry = 3;\n\tss.bgfill = \"url(#grad3)\";\n\t\n\tvar parser = new TimeBandsParser();\n\tparser.parse(defs.innerHTML);\n\tfor (var i = 0; i < parser.bandSections.length; i++) {\n\t\tvar bs = parser.bandSections[i];\n\t\tnew Band(tb,spacing);\n\t\tif (bs.name.startsWith(\"!\")) {\n\t\t\tss.section = true;\n\t\t\tb = new Band(tb,height, bs.name.substr(1));\t\t\n\t\t} else {\n\t\t\tb = new Band(tb,height, bs.name);\n\t\t\tbs.band = b;\n\t\t}\n\t\tfor (var j = 0; j < bs.entries.length; j++) {\n\t\t\tif (ss.section) ss.bgfill = (j % 2 == 0) ? \"url(#grad1)\" : \"url(#grad2)\";\n\t\t\tvar e = bs.entries[j];\n\t\t\tvar interval = e.getIntervalRelativeToDate(startDate);\n\t\t\tb.add(interval[0],interval[1]+1, e.name, ss);\n\t\t}\n\t}\n\t\n\ttb.addOverlay();\n\t\n\tvar today = new BandEntry(\"\", new Date(), new Date());\n\tss.strokeWidth = 0.2;\n\tss.textStroke = \"#000\";\n\tss.textStrokeWidth = 0;\n\tss.opacity = 0.1; \n\tss.bgfill = \"red\";\n\tvar ii = today.getIntervalRelativeToDate(startDate);\n\t\t\n\tvar currentDay = timebands.addBox(tb.top,\n\t\ttb.cellWidth * ii[0], tb.headerHeight,\n\t\ttb.cellWidth * 1, tb.nextYOffset-tb.headerHeight,\n\t\t\"\", ss, \"\", true);\n\t\t\t\n\ttb.view.scalableElements = tb.scalableElements;\n}\n\ntimebands.create = function(svgID, defsID, startYear, startMonth, numberOfDays) {\n\tsvg = document.getElementById(svgID);\n\tdefs = document.getElementById(defsID);\n\ttimebands.init(svg,defs, startYear, startMonth, numberOfDays);\n\tsvg.addEventListener(\"load\",function() {\n\t\ttimebands.init(svg,defs, startYear, startMonth, numberOfDays);\n\t}, false);\n}\n\n\n","var BandEntry = function(name, from, to) {\r\n\tthis.name = name;\r\n\tthis.from = from;\r\n\tthis.to = to;\r\n\t\r\n\tthis.getIntervalRelativeToDate = function(date) {\r\n\t\tvar f = timebands.dateDiffInDays(date, from);\r\n\t\tvar t = timebands.dateDiffInDays(date, to);\r\n\t\treturn [f,t];\r\n\t}\r\n}\r\n\r\nvar BandSection = function(name) {\r\n\tthis.name = name;\r\n\tthis.entries = []; // of type BandEntry\r\n\tthis.toString = function() {\r\n\t\treturn \"BandSection[\" + name + \"]: \" + this.entries.length + \" + entries\";\r\n\t};\r\n\tthis.addEntry = function(e) {\r\n\t\tconsole.log(\"Added entry: \" + e);\r\n\t\tthis.entries.push(e);\r\n\t};\r\n}\r\n\r\n\r\nvar TimeParser = function(implicitYear) {\r\n\tthis.implicitYear = implicitYear;\r\n}\r\n\r\nTimeParser.prototype = {\r\n\tparseInterval: function(b) {\r\n\t\tvar l = b.split(\"-\");\r\n\t\tif (l.length != 2) {\r\n\t\t\tthrow \"The date interval [\" + b + \"] did not contain exactly one hyphen\";\r\n\t\t}\r\n\t\tvar from = this.parseTime(l[0]);\r\n\t\tvar to = this.parseTime(l[1]);\r\n\t\treturn [from,to];\r\n\t},\r\n\t\r\n\tparseTime: function(b) {\r\n\t\tb = b.trim();\r\n\t\tvar l = b.split(\"/\");\r\n\t\tvar date;\r\n\t\tif (l.length == 2) {\r\n\t\t\tdate = new Date(this.implicitYear, l[1]-1, l[0]);\r\n\t\t} else if (l.length == 3) {\r\n\t\t\tvar y = l[2];\r\n\t\t\tif (y<100) y=2000+parseInt(y); // two-digit year\r\n\t\t\tdate = new Date(y, l[1]-1, l[0]);\r\n\t\t} else {\r\n\t\t\tthrow \"The date [\" + b + \"] did not contain one or two /-es\";\r\n\t\t}\r\n\t\tconsole.log(\"Parsed date: \" + date);\r\n\t\treturn date;\r\n\t}\r\n}\r\n\r\nvar TimeBandsParser = function() {\r\n\tthis.bandSections = []; // of type BandSection\r\n\tthis.timeParser = new TimeParser(2015);\r\n}\r\n\r\nTimeBandsParser.prototype = {\r\n\taddBandSection: function(b) {\r\n\t\tif (b === undefined) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.bandSections.push(b);\r\n\t\tconsole.log(\"New section:\" + b.toString());\r\n\t},\r\n\t\r\n\tparseEntry: function(b) {\r\n\t\tvar l = b.split(\":\");\r\n\t\tif (l.length != 2) {\r\n\t\t\tthrow \"The entry [\" + b + \"] did not contain exactly one colon\";\r\n\t\t}\r\n\t\tvar interval = this.timeParser.parseInterval(l[0]);\r\n\t\tvar name = l[1];\r\n\t\tvar e = new BandEntry(name, interval[0], interval[1]);\r\n\t\treturn e;\r\n\t},\r\n\t\r\n\tparse: function(txt) {\r\n\t\tvar lines = txt.match(/[^\\r\\n]+/g);\r\n\t\tvar bandSection = undefined;\r\n\t\tfor (var i = 0; i < lines.length; i++) {\r\n\t\t\tif (i<lines.length-1) {\r\n\t\t\t\tif (lines[i+1].startsWith(\"---\")) {\r\n\t\t\t\t\tbandSection = new BandSection(lines[i]);\r\n\t\t\t\t\tthis.addBandSection(bandSection);\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconsole.log(i + \" \" + lines[i]);\r\n\t\t\tif (bandSection === undefined) {\r\n\t\t\t\tthrow \"When parsing [\" + lines[i] + \"] no section was defined\";\r\n\t\t\t}\r\n\t\t\tvar e = this.parseEntry(lines[i]);\r\n\t\t\tbandSection.addEntry(e);\r\n\t\t}\r\n\t}\r\n}\r\n\t"],"sourceRoot":"/source/"}